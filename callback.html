<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>èªè¨¼ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†</title>
</head>
<body>
  <p>ğŸ” èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ä¸­...</p>
  <pre id="output" style="white-space: pre-wrap; background: #f0f0f0; padding: 10px;"></pre>

  <script>
    const output = document.getElementById("output");

    function show(msg) {
      output.textContent += msg + "\n";
    }

    const hash = location.hash.substring(1);
    show("ğŸ” location.hash: " + location.hash);

    const params = new URLSearchParams(hash);
    const token = params.get("access_token");
    const expiresIn = parseInt(params.get("expires_in"));

    show("ğŸ”‘ token: " + token);
    show("â³ expiresIn: " + expiresIn);

    if (token && expiresIn) {
      const expiresAt = Date.now() + expiresIn * 1000;
      localStorage.setItem("accessToken", token);
      localStorage.setItem("accessTokenExpiresAt", expiresAt.toString());
      show("âœ… ä¿å­˜æˆåŠŸã€‚index.html ã«æˆ»ã‚Šã¾ã™...");
      setTimeout(() => {
        window.location.href = "index.html";
      }, 2000);
    } else {
      show("âŒ èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
  </script>
</body>
</html>

/*<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>èªè¨¼ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†</title>
</head>
<body>
  <p>ğŸ” èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ä¸­...</p>
  <script>
    //const hash = new URLSearchParams(window.location.hash.substring(1));
    //const token = hash.get("access_token");
    //const expiresIn = parseInt(params.get("expires_in"));
    const hash = location.hash.substring(1);
const params = new URLSearchParams(hash);
const token = params.get("access_token");
const expiresIn = parseInt(params.get("expires_in"));
    if (token&&expiresIn) {
      //localStorage.setItem("accessToken", token);
      //localStorage.setItem("tokenExpiresAt", (Date.now() + expires_in * 1000).toString());
        const expiresAt = Date.now() + expiresIn * 1000;
  localStorage.setItem("accessToken", token);
  localStorage.setItem("accessTokenExpiresAt", expiresAt);
      window.location.href = "index.html";
    } else {
      document.body.textContent = "âŒ èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
    }
  </script>
</body>
</html>
*/
